Shader code is derived from the work of Xoppa
http://gist.github.com/xoppa/9766698
